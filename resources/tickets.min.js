var ticketHeaderImage=window.ticketHeaderImage||{};(function(a,b,c){ticketHeaderImage={uploader:function(){var d=wp.media({title:HeaderImageData.title,multiple:false,library:{type:"image"},button:{text:HeaderImageData.button}});d.on("close",function(){var e=d.state().get("selection").toJSON();if(e.length){ticketHeaderImage.render(e[0])}});d.open();return false},render:function(d){b("#tribe_ticket_header_preview").html(ticketHeaderImage.imgHTML(d));b("#tribe_ticket_header_image_id").val(d.id);b("#tribe_ticket_header_remove").show()},imgHTML:function(e){var d='<img src="'+e.url+'" ';d+='width="'+e.width+'" ';d+='height="'+e.height+'" ';d+="/>";return d}};b(document).ready(function(){var f={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:true,changeYear:true,numberOfMonths:3,showButtonPanel:true,onChange:function(){},onSelect:function(m,l){var n=b.datepicker.parseDate("yy-mm-dd",m);if(l.id==="ticket_start_date"){b("#ticket_end_date").datepicker("option","minDate",n);if(n){b(".ticket_start_time").show()}else{b(".ticket_start_time").hide()}}else{b("#ticket_start_date").datepicker("option","maxDate",n);if(n){b(".ticket_end_time").show()}else{b(".ticket_end_time").hide()}}}};b("#ticket_start_date").datepicker(f).keyup(function(l){if(l.keyCode==8||l.keyCode==46){b.datepicker._clearDate(this)}});b("#ticket_end_date").datepicker(f).keyup(function(l){if(l.keyCode==8||l.keyCode==46){b.datepicker._clearDate(this)}});b("input[name=ticket_provider]:radio").change(function(){b("tr.ticket_advanced").hide();b("tr.ticket_advanced_"+this.value).show()});b("input[name=ticket_provider]:checked").each(function(){b("tr.ticket_advanced").hide();b("tr.ticket_advanced_"+this.value).show()});b("a#ticket_form_toggle").click(function(l){b("h4.ticket_form_title_edit").hide();b("h4.ticket_form_title_add").show();b(this).hide();k();b("#ticket_form").show();b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500);l.preventDefault()});b("#ticket_form_cancel").click(function(){k();b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500)});b("#ticket_form_save").click(function(){e();var l={action:"tribe-ticket-add-"+b("input[name=ticket_provider]:checked").val(),formdata:b(".ticket_field").serialize(),post_ID:b("#post_ID").val(),nonce:TribeTickets.add_ticket_nonce};b.post(ajaxurl,l,function(m){if(m.success){k();b("td.ticket_list_container").empty().html(m.data);b(".ticket_time").hide()}},"json").complete(function(){b("html, body").animate({scrollTop:b("#event_tickets").offset().top-50},500);j()})});b("#tribetickets").on("click",".ticket_delete",function(l){l.preventDefault();e();var m={action:"tribe-ticket-delete-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};b.post(ajaxurl,m,function(n){if(n.success){k();b("td.ticket_list_container").empty().html(n.data)}},"json").complete(function(){j()})});b("#tribetickets").on("click",".ticket_edit",function(l){l.preventDefault();b("h4.ticket_form_title_edit").show();b("h4.ticket_form_title_add").hide();e();var m={action:"tribe-ticket-edit-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};b.post(ajaxurl,m,function(p){k();b("#ticket_id").val(p.data.ID);b("#ticket_name").val(p.data.name);b("#ticket_description").val(p.data.description);b("#ticket_price").val(p.data.price);var o=p.data.start_date.substring(0,10);var t=p.data.end_date.substring(0,10);b("#ticket_start_date").val(o);b("#ticket_end_date").val(t);if(p.data.start_date){var s=p.data.start_date.substring(11,13);var r="am";if(parseInt(s)>12){r="pm";s=parseInt(s)-12;s=("0"+s).slice(-2)}if(parseInt(s)===12){r="pm"}b("#ticket_start_hour").val(s);b("#ticket_start_meridian").val(r);b(".ticket_start_time").show()}if(p.data.end_date){var q=p.data.end_date.substring(11,13);var n="am";if(parseInt(q)>12){n="pm";q=parseInt(q)-12;q=("0"+q).slice(-2)}if(parseInt(q)===12){n="pm"}b("#ticket_end_hour").val(q);b("#ticket_end_meridian").val(n);b("#ticket_start_minute").val(p.data.start_date.substring(14,16));b("#ticket_end_minute").val(p.data.end_date.substring(14,16));b(".ticket_end_time").show()}b("tr.ticket_advanced_"+p.data.provider_class).remove();b("tr.ticket.bottom").before(p.data.advanced_fields);b("input:radio[name=ticket_provider]").filter("[value="+p.data.provider_class+"]").click();b("a#ticket_form_toggle").hide();b("#ticket_form").show()},"json").complete(function(){b("html, body").animate({scrollTop:b("#ticket_form_table").offset().top-50},500);j()})}).on("click","#tribe_ticket_header_image",function(l){l.preventDefault();ticketHeaderImage.uploader("","")});var d=b("#tribe_ticket_header_remove");var h=b("#tribe_ticket_header_preview");if(h.find("img").length){d.show()}d.live("click",function(l){l.preventDefault();h.html("");d.hide();b("#tribe_ticket_header_image_id").val("")});function k(){b("a#ticket_form_toggle").show();b("#ticket_form input:not(:button):not(:radio):not(:checkbox)").val("");b("#ticket_form input:checkbox").attr("checked",false);b(".ticket_start_time").hide();b(".ticket_end_time").hide();b("#ticket_form textarea").val("");b("#ticket_form").hide()}function e(){jQuery("#event_tickets").css("opacity","0.5");jQuery("#tribe-loading").show()}function j(){jQuery("#event_tickets").css("opacity","1");jQuery("#tribe-loading").hide()}if(b("#tribe_ticket_header_preview img").length){var g=b("#tribe_ticket_header_preview img");g.removeAttr("width").removeAttr("height");function i(){if(b("#tribetickets").width()<g.width()){g.css("width","95%")}}i()}})})(window,jQuery);