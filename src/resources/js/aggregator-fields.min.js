var tribe_ea=tribe_ea||{};tribe_ea.fields={selector:{container:".tribe-ea",help:".tribe-ea-help",fields:".tribe-ea-field",dropdown:".tribe-ea-dropdown",media_button:".tribe-ea-media_button",datepicker:".tribe-ea-datepicker"},media:{},$:{},construct:{},l10n:window.tribe_l10n_ea_fields},function(e,t,a){"use strict";a.init=function(){a.$.container=e(a.selector.container),a.$.fields=a.$.container.find(a.selector.fields),e.each(a.construct,function(e,t){t(a.$.fields)}),e(document).on("click",".enter-credentials .tribe-save",function(){var t=e(this).closest(".enter-credentials"),a=e(this).closest(".tribe-fieldset").find("input").serialize(),i=ajaxurl+"?action=tribe_save_credentials&which=facebook",r=e.post(i,a);r.done(function(e){e.success&&(t.addClass("credentials-entered"),t.find("#tribe-has-credentials").val(1).change())})})},a.search_id=function(e){var t=null;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0==e?null:t},a.construct.dropdown=function(i){var r=i.filter(a.selector.dropdown).not(".select2-offscreen, .select2-container");return r.each(function(){var i=e(this),r={};if(i.is("select")||(r.id=a.search_id),r.allowClear=!0,i.data("preventClear")&&(r.allowClear=!1),i.is("[data-options]")&&(r.data=i.data("options")),i.is("[data-hide-search]")&&(r.minimumResultsForSearch=1/0),i.is("[multiple]")&&(r.multiple=!0,i.is("[data-tags]")||(r.data=function(){return{results:i.data("options")}}),t.isArray(i.data("separator"))?r.tokenSeparators=i.data("separator"):r.tokenSeparators=[i.data("separator")],r.separator=i.data("separator"),r.regexSeparatorElements=["^("],r.regexSplitElements=["(?:"],e.each(r.tokenSeparators,function(e,t){r.regexSeparatorElements.push("[^"+t+"]+"),r.regexSplitElements.push("["+t+"]")}),r.regexSeparatorElements.push(")$"),r.regexSplitElements.push(")"),r.regexSeparatorString=r.regexSeparatorElements.join(""),r.regexSplitString=r.regexSplitElements.join(""),r.regexToken=new RegExp(r.regexSeparatorString,"ig"),r.regexSplit=new RegExp(r.regexSplitString,"ig")),r.matcher=function(e,i){var n=0==i.toUpperCase().indexOf(e.toUpperCase());if(!n&&"undefined"!=typeof r.tags){var s=t.where(r.tags,{text:i});if(r.tags.length>0&&t.isObject(s)){var o=a.search_id(s[0]);n=0==o.toUpperCase().indexOf(e.toUpperCase())}}return n},i.is("[data-tags]")&&(r.tags=i.data("options"),r.initSelection=function(a,i){var n=[];e(a.val().split(r.regexSplit)).each(function(){var e={id:this,text:this};if(r.tags.length>0&&t.isObject(r.tags[0])){var a=t.where(r.tags,{value:this});a.length>0&&(e=a[0],e={id:e.value,text:e.text})}n.push(e)}),i(n)},r.createSearchChoice=function(e,t){return e.match(r.regexToken)?{id:e,text:e}:void 0},0===r.tags.length&&(r.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var n=i.data("source");r.data={results:[]},r.escapeMarkup=function(e){return e},r.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e.data}},r.ajax.data=function(e,t){return{action:"tribe_ea_dropdown_"+n}}}i.select2(r)}).on("change",function(a){var i=e(this),r=e(this).data("value");i.is("[multiple]")&&i.is("[data-source]")&&(a.added?t.isArray(r)?r.push(a.added):r=[a.added]:r=t.isArray(r)?t.without(r,a.removed):[],i.data("value",r).attr("data-value",JSON.stringify(r)))}),r},a.construct.media_button=function(t){var i=t.filter(a.selector.media_button);return"undefined"!=typeof wp&&wp.media&&wp.media.editor?(i.each(function(){var t=e(this),i=t.data("input"),r=e("#"+i),n=e("#"+i+"_name"),s=a.media[i]=wp.media({title:t.data("mediaTitle"),library:{type:t.data("mimeType")},multiple:!1});s.on("select",function(){var e=s.state(),t=e.get("selection");t&&t.each(function(e){r.data({id:e.attributes.id,text:e.attributes.title}),r.val(e.attributes.id),n.html(e.attributes.title),n.attr("title",e.attributes.title)})}),s.on("open",function(){e(".media-router .media-menu-item").first().trigger("click")})}),a.$.container.on("click",a.selector.media_button,function(t){t.preventDefault();var i=e(this).data("input");return a.media[i].open(i),!1}),i):i},e(document).ready(a.init)}(jQuery,_,tribe_ea.fields);