var tribe_ea=tribe_ea||{};tribe_ea.fields={selector:{container:".tribe-ea",help:".tribe-ea-help",dependent:".tribe-ea-dependent",active:".tribe-ea-active",fields:".tribe-ea-field",dropdown:".tribe-ea-dropdown",media_button:".tribe-ea-media_button",datepicker:".tribe-ea-datepicker"},media:{},$:{},construct:{},l10n:window.tribe_l10n_ea_fields},function(e,t,a){"use strict";a.init=function(){a.$.container=e(a.selector.container),a.$.help=a.$.container.find(a.selector.help),a.$.help.bumpdown(),a.$.fields=a.$.container.find(a.selector.fields),e.each(a.construct,function(e,t){t(a.$.fields)}),a.$.fields.on("change",function(i){var r=e(this),n=r.attr("id"),o=r.val();if(n){var d=a.$.container.find(a.selector.dependent).filter('[data-depends="'+n+'"]');d.each(function(i,r){var n=e(r),d=n.data("conditiselectoron"),s=n.data("conditionNotEmpty")||n.is("[data-condition-not-empty]"),c=n.data("conditionEmpty")||n.is("[data-condition-empty]");c&&""==o?n.addClass(a.selector.active.replace(".","")):s&&""!=o?n.addClass(a.selector.active.replace(".","")):t.isArray(d)&&-1!==t.findIndex(d,o)?n.addClass(a.selector.active.replace(".","")):o==d?n.addClass(a.selector.active.replace(".","")):n.removeClass(a.selector.active.replace(".",""))})}}).trigger("change")},a.search_id=function(e){var t=null;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0==e?null:t},a.construct.dropdown=function(i){var r=i.filter(a.selector.dropdown).not(".select2-offscreen, .select2-container");return r.each(function(){var i=e(this),r={};if(r.id=a.search_id,r.allowClear=!0,i.data("preventClear")&&(r.allowClear=!1),i.is("[data-options]")&&(r.data=i.data("options")),i.is("[data-hide-search]")&&(r.minimumResultsForSearch=1/0),i.is("[multiple]")&&(r.multiple=!0,i.is("[data-tags]")||(r.data=function(){return{results:i.data("options")}}),t.isArray(i.data("separator"))?r.tokenSeparators=i.data("separator"):r.tokenSeparators=[i.data("separator")],r.separator=i.data("separator"),r.regexSeparatorElements=["^("],r.regexSplitElements=["(?:"],e.each(r.tokenSeparators,function(e,t){r.regexSeparatorElements.push("[^"+t+"]+"),r.regexSplitElements.push("["+t+"]")}),r.regexSeparatorElements.push(")$"),r.regexSplitElements.push(")"),r.regexSeparatorString=r.regexSeparatorElements.join(""),r.regexSplitString=r.regexSplitElements.join(""),r.regexToken=new RegExp(r.regexSeparatorString,"ig"),r.regexSplit=new RegExp(r.regexSplitString,"ig")),r.matcher=function(e,i){var n=0==i.toUpperCase().indexOf(e.toUpperCase());if(!n&&"undefined"!=typeof r.tags){var o=t.where(r.tags,{text:i});if(r.tags.length>0&&t.isObject(o)){var d=a.search_id(o[0]);n=0==d.toUpperCase().indexOf(e.toUpperCase())}}return n},i.is("[data-tags]")&&(r.tags=i.data("options"),r.initSelection=function(a,i){var n=[];e(a.val().split(r.regexSplit)).each(function(){var e={id:this,text:this};if(r.tags.length>0&&t.isObject(r.tags[0])){var a=t.where(r.tags,{value:this});a.length>0&&(e=a[0],e={id:e.value,text:e.text})}n.push(e)}),i(n)},r.createSearchChoice=function(e,t){return e.match(r.regexToken)?{id:e,text:e}:void 0},0===r.tags.length&&(r.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var n=i.data("source");r.data={results:[]},r.escapeMarkup=function(e){return e},r.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e}},r.ajax.data=function(e,t){return{action:"tribe_ea_dropdown_"+n}}}i.select2(r)}).on("change",function(a){var i=e(this),r=e(this).data("value");i.is("[multiple]")&&i.is("[data-source]")&&(a.added?t.isArray(r)?r.push(a.added):r=[a.added]:r=t.isArray(r)?t.without(r,a.removed):[],i.data("value",r).attr("data-value",JSON.stringify(r)))}),r},a.construct.media_button=function(t){var i=t.filter(a.selector.media_button);return"undefined"!=typeof wp&&wp.media&&wp.media.editor?(i.each(function(){var t=e(this),i=t.data("input"),r=e("#"+i);if(a.media[i])return void a.media[i].open();var n=a.media[i]=wp.media({title:t.data("mediaTitle"),library:{type:t.data("mimeType")},multiple:!1});n.on("select",function(){var e=n.state(),t=e.get("selection");t&&t.each(function(e){r.select2("data",{id:e.attributes.id,text:e.attributes.title})})}),n.on("open",function(){e(".media-router .media-menu-item").first().trigger("click")}),a.$.container.on("click",a.selector.media_button,function(t){return t.preventDefault(),n.open(e(this)),!1})}),i):i},e(document).ready(a.init)}(jQuery,_,tribe_ea.fields);